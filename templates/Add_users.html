<!DOCTYPE html>
<html>
<head>
    <title>Elenco Utenti</title>
    <style>
        .container {
            display: flex;
        }
        .utenti {
            flex: 1;
            padding: 20px;
        }
        .dettagli {
            flex: 1;
            padding: 20px;
        }
        .utente-selezionato {
            background-color: rgb(191, 191, 191);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="utenti">
            <h2>Elenco Utenti</h2>
            <ul>
                {% for user,info in users.items() %}
                <li value="{{ info[0] }} {{ info[1] }} {{ info[2] }} {{ info[3] }} {{ info[4] }} {{ info[5] }} {{ info[6] }} {{ info[7] }}" onclick="mostraDettagli(this)">{{ user }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="dettagli">
            <h2>Dettagli Utente</h2>
            <div id="dettagli-utente">
                Seleziona un utente per visualizzare i dettagli.
            </div>
            <button onclick="aggiungiUtente()">Aggiungi Utente</button>
        </div>
    </div>
    <script>
        function mostraDettagli(elemento) {
            // Rimuove la classe "utente-selezionato" da tutti gli elementi della lista
            var listaUtenti = document.querySelectorAll('.utenti ul li');
            listaUtenti.forEach(function (utente) {
                utente.classList.remove('utente-selezionato');
            });

            // Aggiunge la classe "utente-selezionato" all'elemento selezionato
            elemento.classList.add('utente-selezionato');

            // Ottiene il nome dell'utente selezionato

            // codicefiscale, nome, cognome, annoNascita, mail, matricola, password
            var st = elemento.getAttribute('value');
            const stringSplitted = st.split(" ")

            // In questo esempio, i dettagli sono predefiniti
            var dettagliUtente = {
                cf: stringSplitted[0],
                name: stringSplitted[1],
                srname: stringSplitted[2],
                mail: stringSplitted[3],
                byear: stringSplitted[4],
                matr : stringSplitted[5],
                pwd : stringSplitted[6],
                corsoLaurea : stringSplitted[7]
            };
             // Use the split values as needed
            console.log(dettagliUtente.cf, dettagliUtente.name, dettagliUtente.srname, dettagliUtente.byear);
            // Aggiorna la sezione dei dettagli con i dati dell'utente selezionato
            var dettagliElemento = document.getElementById('dettagli-utente');
            dettagliElemento.innerHTML = `
                <p><strong>Nome :</strong> ${dettagliUtente.name}</p>
                <p><strong>Cognome :</strong> ${dettagliUtente.srname}</p>
                <p><strong>Codice Fiscale :</strong> ${dettagliUtente.cf}</p>
                <p><strong>Anno Nascita :</strong> ${dettagliUtente.byear}</p>
                <p><strong>Corso di Laurea :</strong> ${dettagliUtente.corsoLaurea}</p>
                <input type="text" name="matricola" placeholder="000000"></input>
                <input type="text" name="mail" placeholder="example@stud.unive.it"></input>
                </br></br>
                Pussy Surprise
            `;
        }

        function aggiungiUtente() {
            var utenteSelezionato = document.querySelector('.utente-selezionato');
            if (utenteSelezionato) {
                var stringSplitted = (utenteSelezionato.innerHTML).split();
                // Effettua una richiesta al server per eliminare l'utente
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/add', true);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                        // Ricarica la pagina dopo aver aggiunto l'utente
                        window.location.reload();
                    }
                };
                xhr.send('cf=' + encodeURIComponent(stringSplitted[0]));
            }
        }
    </script>
</body>
</html>
