<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title></title>
</head>
<body>
    <h1>Men√π a Tendina Dinamico</h1>
    <label for="dropdown">Corso di laurea</label>
    <select id="dropdown">
        <option selected disabled hidden>-----------</option>
    </select>
    <button onclick="showTable()">Visualizza Tabella</button>

    <div id="tableContainer" style="display: none;">
        <form>
            <table border="1">
                <tr>
                    <th>String1</th>
                    <th>String2</th>
                    <th>String3</th>
                    <th>String4</th>
                    <th>Azione</th>
                </tr>
                <tbody id="tableBody"></tbody>
            </table>
        </form>
    </div>

    <script>
        // Lista di test
        var test_list = JSON.parse('{{ list | safe }}');
        populateDropdown();

        function populateDropdown() {
            var dropdown = document.getElementById('dropdown');

            for (var i = 0; i < test_list.length; i++) {
                var option = document.createElement('option');
                option.value = test_list[i].string1;
                option.textContent = test_list[i].string2;
                dropdown.appendChild(option);
            }
        }
        function showTable() {
            var selectedOption = document.getElementById('dropdown').value;
            if (selectedOption === "") {
                alert('Seleziona un\'opzione dalla lista.');
                return;
            }
            var filteredData = filterData(selectedOption);
            var tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            for (var i = 0; i < filteredData.length; i++) {
                var row = tableBody.insertRow();
                var rowData = filteredData[i];

                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);
                var cell4 = row.insertCell(3);
                var cell5 = row.insertCell(4);

                cell1.innerHTML = rowData.string1;
                cell2.innerHTML = rowData.string2;
                cell3.innerHTML = rowData.string3;
                cell4.innerHTML = rowData.string4;
                cell5.innerHTML = '<button onclick="sendData(' + i + ')">Invia</button>';
            }
            document.getElementById('tableContainer').style.display = 'block';
        }

        function filterData(selectedOption) {
            return test_list.filter(function (item) {
                return item.string1 === selectedOption;
            });
        }

        function sendData(rowIndex) {
            var table = document.getElementById('tableBody');
            var rowData = table.rows[rowIndex].cells;

            var dataToSend = {
                'string1': rowData[0].innerHTML,
                'string2': rowData[1].innerHTML,
                'string3': rowData[2].innerHTML,
                'string4': rowData[3].innerHTML
            };

            // Invia i dati al server (implementazione a tua discrezione)
            console.log('Dati da inviare:', dataToSend);

            fetch('/Admin/delete_corso_corsoLaurea', {
                 method: 'POST',
                headers: {
                     'Content-Type': 'application/json'
                },
                 body: JSON.stringify({dataToSend})
             })
             .then(response => response.json())
             .then(data => {
                 alert(data)

             })
             .catch(error => console.error('Errore:', error));
            window.location.reload();
        }
    </script>
</body>
</html>
